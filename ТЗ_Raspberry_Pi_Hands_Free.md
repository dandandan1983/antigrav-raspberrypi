# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: Bluetooth –≥–∞—Ä–Ω–∏—Ç—É—Ä–∞ Hands-Free –Ω–∞ Raspberry Pi 4

## 1. –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

### 1.1. –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞
–°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–æ–≥–∞ Bluetooth –≥–∞—Ä–Ω–∏—Ç—É—Ä—ã hands-free –Ω–∞ –±–∞–∑–µ Raspberry Pi 4, —Å–ø–æ—Å–æ–±–Ω–æ–π –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –º–æ–±–∏–ª—å–Ω—ã–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é –≥–æ–ª–æ—Å–æ–≤—É—é —Å–≤—è–∑—å.

### 1.2. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- –ü—Ä–∏–µ–º –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ Bluetooth
- –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ —á–µ—Ä–µ–∑ –¥–∏–Ω–∞–º–∏–∫–∏
- –ó–∞–ø–∏—Å—å –∑–≤—É–∫–∞ —á–µ—Ä–µ–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞–º–∏ (–ø—Ä–∏–Ω—è—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å/–∑–∞–≤–µ—Ä—à–∏—Ç—å)
- –†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏

### 1.3. –û–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
- Hands-free —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- –ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–∞—è –≥–∞—Ä–Ω–∏—Ç—É—Ä–∞ –¥–ª—è –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤
- –ü—Ä–æ—Ç–æ—Ç–∏–ø –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π
- –ë–∞–∑–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∞—É–¥–∏–æ-—É—Å—Ç—Ä–æ–π—Å—Ç–≤

---

## 2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 2.1. –ê–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ

#### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|--------------|------------|
| **Raspberry Pi 4** | Model B, 2GB+ RAM | –û—Å–Ω–æ–≤–Ω–∞—è –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ |
| **USB Audio –∞–¥–∞–ø—Ç–µ—Ä** | USB Sound Card (3.5mm jack) | –ê—É–¥–∏–æ –≤–≤–æ–¥/–≤—ã–≤–æ–¥ |
| **–ú–∏–∫—Ä–æ—Ñ–æ–Ω** | 3.5mm jack –∏–ª–∏ USB –º–∏–∫—Ä–æ—Ñ–æ–Ω | –ó–∞—Ö–≤–∞—Ç –≥–æ–ª–æ—Å–∞ |
| **–î–∏–Ω–∞–º–∏–∫–∏** | 3.5mm jack –∏–ª–∏ USB –¥–∏–Ω–∞–º–∏–∫–∏ | –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ |
| **Bluetooth –º–æ–¥—É–ª—å** | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Bluetooth 5.0 | –ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–∞—è —Å–≤—è–∑—å |
| **–ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** | GPIO –∫–Ω–æ–ø–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞–º–∏ |
| **–ü–∏—Ç–∞–Ω–∏–µ** | 5V 3A USB-C | –≠–ª–µ–∫—Ç—Ä–æ–ø–∏—Ç–∞–Ω–∏–µ |

#### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
- **I2S –∞—É–¥–∏–æ HAT** (–Ω–∞–ø—Ä–∏–º–µ—Ä, HiFiBerry DAC) –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∑–≤—É–∫–∞
- **USB –≥–∞—Ä–Ω–∏—Ç—É—Ä–∞** - —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–º–∏–∫—Ä–æ—Ñ–æ–Ω + –¥–∏–Ω–∞–º–∏–∫–∏ –≤ –æ–¥–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ)

### 2.2. –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ

#### –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:
- **Raspberry Pi OS** (—Ä–∞–Ω–µ–µ Raspbian) - –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è (Bullseye/Bookworm)
- –ë–∞–∑–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∏–ª–∏ Lite –≤–µ—Ä—Å–∏—è

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|--------|------------|
| **Python** | 3.9+ | –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è |
| **BlueZ** | 5.55+ | Bluetooth —Å—Ç–µ–∫ –¥–ª—è Linux |
| **PulseAudio / PipeWire** | –ê–∫—Ç—É–∞–ª—å–Ω–∞—è | –ê—É–¥–∏–æ —Å–µ—Ä–≤–µ—Ä |
| **ALSA** | –ê–∫—Ç—É–∞–ª—å–Ω–∞—è | –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∞—É–¥–∏–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å |
| **PyBluez** –∏–ª–∏ **dbus-python** | –ê–∫—Ç—É–∞–ª—å–Ω–∞—è | Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Bluetooth |

---

## 3. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 3.1. Bluetooth –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

#### FR-001: –†–µ–∂–∏–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
- –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –≤ —Ä–µ–∂–∏–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–∏–º—ã–º –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∫–∞–∫ "RPi Hands-Free"
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–∑–≤–µ—Å—Ç–Ω—ã–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º

#### FR-002: –ü—Ä–æ—Ñ–∏–ª–∏ Bluetooth
–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –ø—Ä–æ—Ñ–∏–ª–æ–≤:
- **HSP** (Headset Profile) - –±–∞–∑–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–∞—Ä–Ω–∏—Ç—É—Ä—ã
- **HFP** (Hands-Free Profile) - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å hands-free
- **A2DP** (Advanced Audio Distribution Profile) - –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –º—É–∑—ã–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### FR-003: –°–æ–ø—Ä—è–∂–µ–Ω–∏–µ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PIN-–∫–æ–¥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "0000" –∏–ª–∏ "1234")
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∏–∑–≤–µ—Å—Ç–Ω–æ–º—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É

### 3.2. –ê—É–¥–∏–æ —Ñ—É–Ω–∫—Ü–∏–∏

#### FR-004: –ó–∞—Ö–≤–∞—Ç –∑–≤—É–∫–∞ (–º–∏–∫—Ä–æ—Ñ–æ–Ω)
- –ß–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏: 8 kHz –∏–ª–∏ 16 kHz (—Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–π —Å–≤—è–∑–∏)
- –§–æ—Ä–º–∞—Ç: mono, 16-bit PCM
- –ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ —ç—Ö–∞ (AEC - Acoustic Echo Cancellation) - –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ
- –®—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### FR-005: –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ (–¥–∏–Ω–∞–º–∏–∫–∏)
- –ß–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏: 8 kHz –∏–ª–∏ 16 kHz
- –§–æ—Ä–º–∞—Ç: mono, 16-bit PCM
- –†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –∏ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É—Å–∏–ª–µ–Ω–∏–µ (AGC) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

#### FR-006: –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞/–ø—Ä–∏–µ–º–Ω–∏–∫–∞ –∞—É–¥–∏–æ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏

### 3.3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞–º–∏

#### FR-007: –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
- –ü—Ä–∏–Ω—è—Ç—å –≤—Ö–æ–¥—è—â–∏–π –≤—ã–∑–æ–≤
- –û—Ç–∫–ª–æ–Ω–∏—Ç—å –≤—Ö–æ–¥—è—â–∏–π –≤—ã–∑–æ–≤
- –ó–∞–≤–µ—Ä—à–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –Ω–∞–±–æ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω–æ–º–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ì–æ–ª–æ—Å–æ–≤–æ–π –Ω–∞–±–æ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### FR-008: –ò–Ω–¥–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞
- –°–≤–µ—Ç–æ–¥–∏–æ–¥–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:
  - –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–º–∏–≥–∞–Ω–∏–µ)
  - –ü–æ–¥–∫–ª—é—á–µ–Ω–æ (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ)
  - –í—Ö–æ–¥—è—â–∏–π –≤—ã–∑–æ–≤ (–±—ã—Å—Ç—Ä–æ–µ –º–∏–≥–∞–Ω–∏–µ)
  - –ê–∫—Ç–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤ (–º–µ–¥–ª–µ–Ω–Ω–æ–µ –º–∏–≥–∞–Ω–∏–µ)
- –ó–≤—É–∫–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –¥–ª—è —Å–æ–±—ã—Ç–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 3.4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º

#### FR-009: –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (GPIO)
- **–ö–Ω–æ–ø–∫–∞ 1**: –ü—Ä–∏–Ω—è—Ç—å/–∑–∞–≤–µ—Ä—à–∏—Ç—å –≤—ã–∑–æ–≤
- **–ö–Ω–æ–ø–∫–∞ 2**: –û—Ç–∫–ª–æ–Ω–∏—Ç—å –≤—ã–∑–æ–≤
- **–ö–Ω–æ–ø–∫–∞ 3**: –£–≤–µ–ª–∏—á–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å
- **–ö–Ω–æ–ø–∫–∞ 4**: –£–º–µ–Ω—å—à–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å

#### FR-010: –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
- –°–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø–æ—Å–ª–µ —Å–±–æ–µ–≤

---

## 4. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### 4.1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

```mermaid
graph TB
    Phone[üì± –¢–µ–ª–µ—Ñ–æ–Ω] <-->|Bluetooth HSP/HFP| BT[Bluetooth –º–µ–Ω–µ–¥–∂–µ—Ä]
    BT <--> Main[–ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å Python]
    Main <--> Audio[–ê—É–¥–∏–æ –º–µ–Ω–µ–¥–∂–µ—Ä]
    Main <--> Call[–ú–µ–Ω–µ–¥–∂–µ—Ä –≤—ã–∑–æ–≤–æ–≤]
    Main <--> GPIO[GPIO –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä]
    Audio <--> PA[PulseAudio]
    PA <--> Mic[üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω]
    PA <--> Speaker[üîä –î–∏–Ω–∞–º–∏–∫–∏]
    GPIO <--> Buttons[–§–∏–∑–∏—á–µ—Å–∫–∏–µ –∫–Ω–æ–ø–∫–∏]
    GPIO <--> LED[–°–≤–µ—Ç–æ–¥–∏–æ–¥—ã]
```

### 4.2. –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ –º–æ–¥—É–ª–∏

#### –ú–æ–¥—É–ª—å 1: Bluetooth Manager (`bluetooth_manager.py`)
```python
"""
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Bluetooth –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–∞–ø—Ç–µ—Ä–∞
- –†–µ–∂–∏–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
- –°–æ–ø—Ä—è–∂–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π HSP/HFP
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è
"""
```

#### –ú–æ–¥—É–ª—å 2: Audio Manager (`audio_manager.py`)
```python
"""
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫–∞–º–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PulseAudio
- –ó–∞—Ö–≤–∞—Ç —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
- –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –¥–∏–Ω–∞–º–∏–∫–∏
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫–æ–≤
- –†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
"""
```

#### –ú–æ–¥—É–ª—å 3: Call Manager (`call_manager.py`)
```python
"""
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–º–∏ –≤—ã–∑–æ–≤–∞–º–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ AT –∫–æ–º–∞–Ω–¥ (HFP)
- –ü—Ä–∏–Ω—è—Ç–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–º –≤—ã–∑–æ–≤–æ–º
- –ò–Ω–¥–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞
"""
```

#### –ú–æ–¥—É–ª—å 4: GPIO Controller (`gpio_controller.py`)
```python
"""
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ GPIO (–∫–Ω–æ–ø–∫–∏, —Å–≤–µ—Ç–æ–¥–∏–æ–¥—ã)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–æ–¥–∏–æ–¥–∞–º–∏
- Debouncing –¥–ª—è –∫–Ω–æ–ø–æ–∫
- –°–æ–±—ã—Ç–∏—è –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–æ–¥—É–ª—è
"""
```

#### –ú–æ–¥—É–ª—å 5: Main Application (`main.py`)
```python
"""
–ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª–µ–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
"""
```

#### –ú–æ–¥—É–ª—å 6: Configuration (`config.py`)
```python
"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Bluetooth
- –ê—É–¥–∏–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- GPIO –ø–∏–Ω—ã
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
"""
```

#### –ú–æ–¥—É–ª—å 7: Logger Setup (`logger_setup.py`)
```
"""
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–≥–µ—Ä–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (—Ñ–∞–π–ª/–∫–æ–Ω—Å–æ–ª—å)
- –§–æ—Ä–º–∞—Ç—ã –∏ —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –†–æ—Ç–∞—Ü–∏—è –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –ª–æ–≥-—Ñ–∞–π–ª—ã
"""
```

#### –ú–æ–¥—É–ª—å 8: –¢–µ—Å—Ç—ã
```
"""
–ù–∞–±–æ—Ä –º–æ–¥—É–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `tests/` –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥ AT-–∫–æ–º–∞–Ω–¥,
–∞—É–¥–∏–æ –∏ –ª–æ–≥–∏–∫—É –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∑–≤–æ–Ω–æ–∫. CI/—Ç–µ—Å—Ç–æ–≤—ã–π –ø–∞–π–ø–ª–∞–π–Ω —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è.
"""
```

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: —Ñ–∞–π–ª `config.ini` –≤–∫–ª—é—á–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `state_dir` ‚Äî
–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `/var/lib/rpi-handsfree`).

## Implementation status

The repository contains a working, pragmatic implementation focused on core hands-free call handling.

- Implemented:
  - Basic Bluetooth adapter initialization and discoverable mode via BlueZ (using `pydbus` or `bluetoothctl` fallback) (`bluetooth_manager.py`).
  - RFCOMM reader and AT-line parsing for HFP/HSP events (RING, +CIEV/+CIND, +CLCC, +VGS/+VGM) and callback dispatching.
  - Call control: `CallManager` implements `incoming`, `answer`, and `hangup` using AT commands (`ATA`, `AT+CHUP`).
  - Audio routing with PulseAudio (`pulsectl`) including setting BlueZ card profile to `headset_head_unit` and moving SCO source-outputs to a physical mic (`audio_manager.py`).
  - GPIO button handling and LED patterns with debouncing and polling fallback (`gpio_controller.py`).
  - Logging configuration with file/console handlers and a fallback writable state directory (`logger_setup.py`).
  - Persistent local state (volume) stored under `misc.state_dir` (`audio_manager.py`).
  - Unit tests in `tests/` covering AT parsing and basic call logic.

- Partially implemented / planned (not fully automatic or production hardened):
  - Automatic reconnect logic (config contains `reconnect_*` keys but reconnect algorithm is not implemented in `bluetooth_manager.py`).
  - Advanced audio preprocessing: AEC/AGC/noise-reduction flags exist in `config.ini` but audio preprocessing pipeline is not implemented in `audio_manager.py`.
  - Secure storage of Bluetooth pairing keys (not implemented); pairing relies on BlueZ and system agent.
  - Full A2DP usage switching and simultaneous A2DP/HFP management is not fully implemented; `audio_manager` can set profiles but automatic switching logic is limited.

This –¢–ó has been updated to reflect the current implementation. For feature requests (AEC, AGC, encrypted key storage, robust auto-reconnect), consider them as next milestones.

### 4.3. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```mermaid
sequenceDiagram
    participant Phone as –¢–µ–ª–µ—Ñ–æ–Ω
    participant BT as Bluetooth Manager
    participant Main as Main App
    participant Audio as Audio Manager
    participant Call as Call Manager
    
    Phone->>BT: –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    BT->>Main: –°–æ–±—ã—Ç–∏–µ: –Ω–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    Main->>Audio: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞—É–¥–∏–æ –º–∞—Ä—à—Ä—É—Ç
    Audio-->>Main: –ì–æ—Ç–æ–≤–æ
    Main->>BT: –ü—Ä–∏–Ω—è—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    BT-->>Phone: –ü–æ–¥–∫–ª—é—á–µ–Ω–æ
    
    Phone->>BT: –í—Ö–æ–¥—è—â–∏–π –≤—ã–∑–æ–≤ (AT –∫–æ–º–∞–Ω–¥–∞)
    BT->>Call: –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–π –≤—ã–∑–æ–≤
    Call->>Main: –°–æ–±—ã—Ç–∏–µ: –≤—Ö–æ–¥—è—â–∏–π –≤—ã–∑–æ–≤
    Main->>Call: –ü—Ä–∏–Ω—è—Ç—å –≤—ã–∑–æ–≤
    Call->>BT: –û—Ç–ø—Ä–∞–≤–∏—Ç—å AT –∫–æ–º–∞–Ω–¥—É (ATA)
    BT-->>Phone: –í—ã–∑–æ–≤ –ø—Ä–∏–Ω—è—Ç
    
    Main->>Audio: –ù–∞—á–∞—Ç—å –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫
    Audio-->Phone: –ü–µ—Ä–µ–¥–∞—á–∞ –∞—É–¥–∏–æ (–º–∏–∫—Ä–æ—Ñ–æ–Ω)
    Phone-->Audio: –ü–æ–ª—É—á–µ–Ω–∏–µ –∞—É–¥–∏–æ (–¥–∏–Ω–∞–º–∏–∫–∏)
```

---

## 5. –î–µ—Ç–∞–ª—å–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

### 5.1. Bluetooth –ø—Ä–æ—Ñ–∏–ª–∏

#### HSP (Headset Profile)
- –ë–∞–∑–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–∞—Ä–Ω–∏—Ç—É—Ä—ã
- –ú–æ–Ω–æ –∞—É–¥–∏–æ –∫–∞–Ω–∞–ª
- –ü—Ä–æ—Å—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### HFP (Hands-Free Profile)
–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –í–∫–ª—é—á–∞–µ—Ç AT –∫–æ–º–∞–Ω–¥—ã:
- `AT+BRSF` - Feature negotiation
- `AT+CIND` - Indicator status
- `AT+CMER` - Event reporting
- `ATA` - Answer call
- `AT+CHUP` - Hang up call
- `ATD` - Dial number
- `AT+VGS` - Speaker volume
- `AT+VGM` - Microphone volume

### 5.2. –ê—É–¥–∏–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### PulseAudio –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```bash
# PulseAudio: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ Bluetooth HSP/HFP –ø—Ä–æ—Ñ–∏–ª—å
pactl list cards
pactl set-card-profile <card-id> headset_head_unit

# –î–ª—è PipeWire + pipewire-pulse –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ pw-cli/pactl
```

### 5.3. GPIO —Å—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

| GPIO Pin | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
|----------|------------|-------------------|
| GPIO 17 | –ö–Ω–æ–ø–∫–∞ "–û—Ç–≤–µ—Ç–∏—Ç—å/–ó–∞–≤–µ—Ä—à–∏—Ç—å" | Pull-up, –∞–∫—Ç–∏–≤–Ω—ã–π LOW |
| GPIO 27 | –ö–Ω–æ–ø–∫–∞ "–û—Ç–∫–ª–æ–Ω–∏—Ç—å" | Pull-up, –∞–∫—Ç–∏–≤–Ω—ã–π LOW |
| GPIO 22 | –ö–Ω–æ–ø–∫–∞ "–ì—Ä–æ–º–∫–æ—Å—Ç—å +" | Pull-up, –∞–∫—Ç–∏–≤–Ω—ã–π LOW |
| GPIO 23 | –ö–Ω–æ–ø–∫–∞ "–ì—Ä–æ–º–∫–æ—Å—Ç—å -" | Pull-up, –∞–∫—Ç–∏–≤–Ω—ã–π LOW |
| GPIO 24 | –°–≤–µ—Ç–æ–¥–∏–æ–¥ "–°—Ç–∞—Ç—É—Å" | –†–µ–∑–∏—Å—Ç–æ—Ä 220Œ©, –∞–∫—Ç–∏–≤–Ω—ã–π HIGH |
| GPIO 25 | –°–≤–µ—Ç–æ–¥–∏–æ–¥ "–í—ã–∑–æ–≤" | –†–µ–∑–∏—Å—Ç–æ—Ä 220Œ©, –∞–∫—Ç–∏–≤–Ω—ã–π HIGH |

---

## 6. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 6.1. –ó–∞–¥–µ—Ä–∂–∫–∞ (Latency)
- –û–±—â–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –∞—É–¥–∏–æ: < 150 –º—Å
- –ó–∞–¥–µ—Ä–∂–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥: < 100 –º—Å
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ –Ω–∞ –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏: < 50 –º—Å

### 6.2. –ö–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —ç—Ö–∞ –ø—Ä–∏ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –¥–æ 80%
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏—Å–∫–∞–∂–µ–Ω–∏—è –ø—Ä–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π –≥—Ä–æ–º–∫–æ—Å—Ç–∏
- –†–∞–∑–±–æ—Ä—á–∏–≤–æ—Å—Ç—å —Ä–µ—á–∏: –≤—ã—Å–æ–∫–∞—è

### 6.3. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- –í—Ä–µ–º—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã: > 24 —á–∞—Å–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π –±–µ–∑ –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

---

## 7. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 7.1. Bluetooth –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Secure Simple Pairing (SSP)
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π —Å–æ–ø—Ä—è–∂–µ–Ω–∏—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ MAC-–∞–¥—Ä–µ—Å–∞–º

### 7.2. –°–∏—Å—Ç–µ–º–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ –æ—Ç –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

---

## 8. –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 8.1. –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è (1-2 –¥–Ω—è)
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Raspberry Pi OS
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Python 3.9+
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ (BlueZ, PulseAudio, ALSA)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Bluetooth

### 8.2. –≠—Ç–∞–ø 2: –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (3-5 –¥–Ω–µ–π)
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `bluetooth_manager.py`
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–∞–ø—Ç–µ—Ä–∞
  - –†–µ–∂–∏–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
  - –°–æ–ø—Ä—è–∂–µ–Ω–∏–µ
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `audio_manager.py`
  - –ó–∞—Ö–≤–∞—Ç —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
  - –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –¥–∏–Ω–∞–º–∏–∫–∏
- [ ] –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Bluetooth –∏ –∞—É–¥–∏–æ

### 8.3. –≠—Ç–∞–ø 3: –ü—Ä–æ—Ñ–∏–ª—å HFP (3-5 –¥–Ω–µ–π)
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `call_manager.py`
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ AT –∫–æ–º–∞–Ω–¥
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞–º–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Bluetooth Manager
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤

### 8.4. –≠—Ç–∞–ø 4: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –∏–Ω–¥–∏–∫–∞—Ü–∏—è (2-3 –¥–Ω—è)
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `gpio_controller.py`
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–æ–¥–∏–æ–¥–∞–º–∏
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –∫–Ω–æ–ø–æ–∫ –∏ —Å–≤–µ—Ç–æ–¥–∏–æ–¥–æ–≤
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 8.5. –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (3-5 –¥–Ω–µ–π)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π –≤ `main.py`
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ (systemd service)
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫ –∞—É–¥–∏–æ
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è —ç—Ö–∞ (AEC)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

### 8.6. –≠—Ç–∞–ø 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (2-3 –¥–Ω—è)
- [ ] –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ù–∞–ø–∏—Å–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
- [ ] –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞

**–û–±—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 14-23 –¥–Ω—è**

---

## 9. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

### 9.1. –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# Bluetooth
sudo apt install -y bluez bluez-tools python3-bluez

# –ê—É–¥–∏–æ
sudo apt install -y pulseaudio pulseaudio-module-bluetooth alsa-utils
# –ò–ª–∏, –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ PipeWire –≤–º–µ—Å—Ç–æ PulseAudio:
# sudo apt install -y pipewire pipewire-pulse

# Python –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
sudo apt install -y python3 python3-pip python3-dev python3-venv

# GPIO
sudo apt install -y python3-rpi.gpio python3-gpiozero

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
sudo apt install -y git vim htop
```

### 9.2. Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
```python
# requirements.txt
pybluez>=0.23
PyGObject>=3.40.0
dbus-python>=1.2.18
RPi.GPIO>=0.7.1
gpiozero>=1.6.2
pulsectl>=20.0.0
pydbus>=0.6.0
```

### 9.3. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
```python
# –î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ
numpy>=1.21.0
scipy>=1.7.0
sounddevice>=0.4.4
webrtcvad>=2.0.10  # Voice Activity Detection
```

---

## 10. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 10.1. BlueZ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```ini
# /etc/bluetooth/main.conf
[General]
Name = RPi Hands-Free
Class = 0x200404
DiscoverableTimeout = 0
PairableTimeout = 0
Privacy = device

[Policy]
AutoEnable=true
```

### 10.2. Systemd —Å–µ—Ä–≤–∏—Å
```ini
# /etc/systemd/system/rpi-handsfree.service
[Unit]
Description=Raspberry Pi Hands-Free Headset
After=bluetooth.target sound.target
Requires=bluetooth.target

[Service]
Type=simple
User=pi
ExecStart=/usr/bin/python3 /home/pi/rpi-handsfree/main.py
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

### 10.3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```python
# config.ini
[bluetooth]
device_name = RPi Hands-Free
device_class = 0x200404
discoverable = true
auto_reconnect = true

[audio]
sample_rate = 16000
channels = 1
format = S16_LE
buffer_size = 2048

[gpio]
button_answer = 17
button_reject = 27
button_vol_up = 22
button_vol_down = 23
led_status = 24
led_call = 25

[misc]
log_level = INFO
log_file = /var/log/rpi-handsfree.log
```

---

## 11. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 11.1. Unit —Ç–µ—Å—Ç—ã
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 11.2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- –¢–µ—Å—Ç Bluetooth –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –¢–µ—Å—Ç –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫–∞ (loopback)
- –¢–µ—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–∑–æ–≤–∞–º–∏
- –¢–µ—Å—Ç GPIO –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

### 11.3. –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–µ—Å—Ç—ã
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É —Ç–µ–ª–µ—Ñ–æ–Ω—É
- –¢–µ—Å—Ç –≤—Ö–æ–¥—è—â–∏—Ö/–∏—Å—Ö–æ–¥—è—â–∏—Ö –≤—ã–∑–æ–≤–æ–≤
- –¢–µ—Å—Ç –∫–∞—á–µ—Å—Ç–≤–∞ –∑–≤—É–∫–∞
- –¢–µ—Å—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ (–¥–ª–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
- –¢–µ—Å—Ç –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ä–∞–∑—Ä—ã–≤–∞ —Å–≤—è–∑–∏

---

## 12. –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–µ—à–µ–Ω–∏—è

### 12.1. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

| –ü—Ä–æ–±–ª–µ–º–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ—à–µ–Ω–∏–µ |
|----------|----------|---------|
| **–ó–∞–¥–µ—Ä–∂–∫–∞ –∞—É–¥–∏–æ** | Bluetooth SCO –∏–º–µ–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±—É—Ñ–µ—Ä–æ–≤, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö API |
| **–ö–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞** | SCO –ø—Ä–æ—Ñ–∏–ª—å - –Ω–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Wide-Band Speech (16 kHz) –≤–º–µ—Å—Ç–æ Narrow-Band (8 kHz) |
| **–≠—Ö–æ** | –ó–≤—É–∫ –∏–∑ –¥–∏–Ω–∞–º–∏–∫–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω | –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ —ç—Ö–∞ (AEC), —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–Ω–µ—Å–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∏ –¥–∏–Ω–∞–º–∏–∫–∞ |
| **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** | –ù–µ –≤—Å–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã –æ–¥–∏–Ω–∞–∫–æ–≤–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –ø—Ä–æ—Ñ–∏–ª–∏ | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è fallback –Ω–∞ HSP |
| **–≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ** | Raspberry Pi –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –º–Ω–æ–≥–æ —ç–Ω–µ—Ä–≥–∏–∏ | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∏—Ç–∞–Ω–∏—è, –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ |

### 12.2. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π USB –∞—É–¥–∏–æ –∞–¥–∞–ø—Ç–µ—Ä
- –†–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω –ø–æ–¥–∞–ª—å—à–µ –æ—Ç –¥–∏–Ω–∞–º–∏–∫–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Ñ–æ–Ω
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å BlueZ –∏ firmware Raspberry Pi

---

## 13. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (Future Work)

### 13.1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ A2DP –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –º—É–∑—ã–∫–∏ –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
- [ ] –ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Assistant/Alexa)
- [ ] OLED –¥–∏—Å–ø–ª–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- [ ] –ó–∞–ø–∏—Å—å —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
- [ ] –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫
- [ ] Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 13.2. –£–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∑–≤—É–∫–∞
- [ ] –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ (Deep Learning)
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ —É—Å–∏–ª–µ–Ω–∏—è (AGC)
- [ ] –≠–∫–≤–∞–ª–∞–π–∑–µ—Ä
- [ ] –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–≤—É–∫

### 13.3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] MQTT –¥–ª—è IoT –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [ ] REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —É–º–Ω—ã–º –¥–æ–º–æ–º (Home Assistant)

---

## 14. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 14.1. –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Bluetooth
hciconfig -a
bluetoothctl

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É–¥–∏–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
aplay -l
arecord -l
pactl list cards

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
arecord -f cd test.wav
aplay test.wav

# –õ–æ–≥–∏ Bluetooth
journalctl -u bluetooth -f

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
python3 main.py --debug
```

### 14.2. Troubleshooting

| –ü—Ä–æ–±–ª–µ–º–∞ | –í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|-------------------|---------|
| –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è | Bluetooth –≤—ã–∫–ª—é—á–µ–Ω | `sudo systemctl start bluetooth` |
| –ù–µ—Ç –∑–≤—É–∫–∞ | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `pactl list sinks` |
| –≠—Ö–æ | –ü–µ—Ç–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ | –£–º–µ–Ω—å—à–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å, –≤–∫–ª—é—á–∏—Ç—å AEC |
| –ù–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è | –°—Ç–∞—Ä–æ–µ —Å–æ–ø—Ä—è–∂–µ–Ω–∏–µ | –£–¥–∞–ª–∏—Ç—å –∏ –∑–∞–Ω–æ–≤–æ —Å–ø–∞—Ä–∏—Ç—å |

---

## 15. –°—Å—ã–ª–∫–∏ –∏ —Ä–µ—Å—É—Ä—Å—ã

### 15.1. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [BlueZ Documentation](http://www.bluez.org/)
- [Hands-Free Profile Specification](https://www.bluetooth.org/docman/handlers/downloaddoc.ashx?doc_id=238193)
- [PulseAudio Documentation](https://www.freedesktop.org/wiki/Software/PulseAudio/)
- [Raspberry Pi GPIO](https://www.raspberrypi.org/documentation/hardware/raspberrypi/)

### 15.2. –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–µ–∫—Ç–æ–≤
- [PiMyLifeUp Bluetooth Audio](https://pimylifeup.com/raspberry-pi-bluetooth-audio/)
- [Balena Sound](https://github.com/balenalabs/balena-sound)

---

## 16. –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-19  
**–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è:** Python 3.9+  
**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:** Raspberry Pi 4 Model B  
**–õ–∏—Ü–µ–Ω–∑–∏—è:** MIT (–∏–ª–∏ –Ω–∞ –≤–∞—à–µ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ)

---

> [!IMPORTANT]
> –≠—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–Ω–æ–π —Ç–æ—á–∫–æ–π –ø—Ä–æ–µ–∫—Ç–∞. –í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.



